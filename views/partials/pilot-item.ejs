<%
    const reporterNameList = typeof reporterNames !== "undefined"
        ? reporterNames
        : (typeof reporterName !== "undefined" ? [reporterName] : []);
    const normalizedReporterNames = (Array.isArray(reporterNameList) ? reporterNameList : [reporterNameList])
        .map((name) => String(name ?? "").trim().toLowerCase())
        .filter((name) => !!name);
    const normalizedPilotName = String(pilot.name ?? "").trim().toLowerCase();
    const isReportingCharacter = normalizedReporterNames.includes(normalizedPilotName);
    const pilotBackgroundColor = isReportingCharacter ? "#16a34a" : pilot.backgroundColor;
    const displayPilotName = String(pilot.name ?? "").trim();
    const normalizedHint = String(pilot.hint ?? "").trim().toLowerCase();
    const isFriendlyPilot =
        normalizedHint.length === 0 ||
        /in your fleet|in your gang/.test(normalizedHint) ||
        /in your capsuleer corporation|in your corporation/.test(normalizedHint) ||
        /in your alliance/.test(normalizedHint) ||
        /good standing/.test(normalizedHint) ||
        /excellent standing/.test(normalizedHint);
%>
<div
    class="pilot-chip"
    data-pilot-background="<%= pilotBackgroundColor %>"
    data-pilot-name="<%= normalizedPilotName %>"
    data-is-friendly="<%= isFriendlyPilot ? 'true' : 'false' %>"
    style="padding: 2px 10px; border: 1px solid #374151; border-radius: 6px; color: #ffffff; white-space: nowrap; display: flex; align-items: center; gap: 8px; min-height: 30px; box-sizing: border-box; width: 100%; max-width: 100%; min-width: 220px; overflow: hidden;"
    title="<%= pilot.hint || 'Pilot has no standing' %>">
    <% if (pilot.characterId && Number(pilot.characterId) > 0) { %>
        <img
            src="https://images.evetech.net/characters/<%= pilot.characterId %>/portrait?size=128"
            alt="<%= pilot.name %> portrait"
            width="24"
            height="24"
            style="width: 24px; height: 24px; border-radius: 4px; flex: 0 0 24px;" />
    <% } %>
    <% if (pilot.characterId && Number(pilot.characterId) > 0) { %>
        <a
            href="https://zkillboard.com/character/<%= Number(pilot.characterId) %>/"
            target="_blank"
            rel="noopener noreferrer"
            title="Open <%= pilot.name %> on zKillboard"
            style="display: block; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #ffffff; text-decoration: underline;">
            <%= pilot.name %>
        </a>
    <% } else { %>
        <span style="display: block; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><%= pilot.name %></span>
    <% } %>
    <span style="flex: 1 1 auto;"></span>
    <button
        type="button"
        class="pilot-filter-toggle"
        data-pilot-name="<%= normalizedPilotName %>"
        data-filter-active="false"
        aria-pressed="false"
        data-pilot-display-name="<%= displayPilotName %>"
        aria-label="Filter by <%= pilot.name %>"
        title="Filter by this pilot"
        onclick="if(window.gridScoutTogglePilotFilter){window.gridScoutTogglePilotFilter(this.getAttribute('data-pilot-display-name'));}"
        style="background: transparent; border: 1px solid #4b5563; color: #d1d5db; border-radius: 4px; width: 20px; height: 20px; min-width: 20px; padding: 0; line-height: 1; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; flex: 0 0 20px;">
        <svg viewBox="0 0 24 24" width="12" height="12" aria-hidden="true" focusable="false" style="display: block; fill: currentColor;">
            <path d="M3 5h18l-7 8v6l-4 2v-8z"></path>
        </svg>
    </button>
</div>
